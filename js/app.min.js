'use strict';

(function () {
    const hamburgerIcon = document.getElementById("hamburger");
    let isMenuOpen = true;

    function openMenu() {
        let sections = document.querySelectorAll("#home, #projects, #about, #contact");
        hamburgerIcon.classList.add("icon--hamburger--active");

        sections.forEach(section => {
            section.classList.add("nav__element");
            section.classList.add("nav__element--" + section.id);

            section.addEventListener("click", () => {
                closeMenu();
                location.href = "#" + section.id;
            });
        });

        isMenuOpen = false;
    }

    function closeMenu() {
        let sections = document.querySelectorAll("#home, #projects, #about, #contact");
        hamburgerIcon.classList.remove("icon--hamburger--active");
        document.getElementById("bg-video")?.play();

        sections.forEach(section => {
            section.classList.remove("nav__element");
            section.classList.remove("nav__element--" + section.id);
        });

        isMenuOpen = true;
    }

    if (window.IntersectionObserver) {
        const socialActions = document.querySelector(".social-actions");
        const contactSection = document.getElementById("get-in-touch");

        const contactObserver = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    socialActions.classList.add("return");
                } else {
                    socialActions.classList.remove("return");
                }
            });
        });

        if (contactSection) {
            contactObserver.observe(contactSection);
        }

        const animateObserver = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add(entry.target.getAttribute("data-animation"));
                    entry.target.classList.remove("animate");
                    animateObserver.unobserve(entry.target);
                }
            });
        });

        document.querySelectorAll(".animate").forEach(element => {
            animateObserver.observe(element);
        });

        const videoObserver = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.play();
                    videoObserver.unobserve(entry.target);
                }
            });
        }, { threshold: 0.5 });

        document.querySelectorAll("video").forEach(video => {
            videoObserver.observe(video);
        });

    } else {
        console.log("IntersectionObserver not present");
    }

    hamburgerIcon?.addEventListener("click", () => {
        isMenuOpen ? openMenu() : closeMenu();
    });
})();

document.addEventListener("DOMContentLoaded", () => {
    const container = document.querySelector(".bubbles-container");

    for (let i = 0; i < 20; i++) { 
        const bubble = document.createElement("div");
        bubble.classList.add("bubble");
        bubble.style.left = `${Math.random() * 100}%`;
        bubble.style.animationDuration = `${Math.random() * 10 + 5}s`;
        container.appendChild(bubble);
    }
});
